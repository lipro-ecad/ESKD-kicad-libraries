# ESKD – KiCad Symbol and Footprint Libraries

This repository contains the special [KiCad] schematic symbol and PCB footprint
libraries for [ESKD]. In addition to this it provides 3D models for rendering
and Mechanical CAD (MCAD) integration. The 3D models need a mechanical model
source, preferably [STEP] (a manually-modelled or script-generated file); its
[WRL] counterpart file must be obtained as a conversion from the MCAD model.

> **[ESKD] – "Einheitliches System der Konstruktionsdokumentation des [RGW]"**

For more details about [ESKD] see the README in [KiCad environment for ESKD].

[RGW]: https://de.wikipedia.org/wiki/Rat_f%C3%BCr_gegenseitige_Wirtschaftshilfe "Rat für gegenseitige Wirtschaftshilfe"
[ESKD]: https://d-nb.info/551201940 "Deutsche Netionalbibliothek"
[STEP]: https://en.wikipedia.org/wiki/ISO_10303-21 "ISO 10303-21 Clear Text Encoding of the Exchange Structure"
[WRL]: https://en.wikipedia.org/wiki/VRML "VRML file extension (Virtual Reality Modeling Language)"
[KiCad]: https://www.kicad.org/ "A Cross Platform and Open Source Electronics Design Automation Suite"
[KiCad environment for ESKD]: https://github.com/lipro-ecad/ESKD-kicad-environment

**The libraries in this repository are intended for KiCad version 6.x**

Each symbol library is stored as a `.kicad_sym` file below the `symbols`
directory. See KiCad online documentation to understand the new KiCad
version 6.x [Symbol Library File Format] if needed.

[Symbol Library File Format]: https://dev-docs.kicad.org/en/file-formats/sexpr-symbol-lib

Each footprint library is stored as a directory with the `.pretty` suffix
below the `footprints` directory. The footprint files are `.kicad_mod` files
within. See KiCad online documentation to understand the new KiCad version 6.x
[Footprint Library File Format] if needed.

[Footprint Library File Format]: https://dev-docs.kicad.org/en/file-formats/sexpr-footprint

Each 3D model library is stored as a directory with the `.3dshapes` suffix
below the `3dmodels` directory. The 3D model files are `.step` and `.wrl`
files within. The 3D model library supports two file formats:

* **STEP** (`.step`) files are used for integration with MCAD software
  packages. STEP models must be 1:1 in mm, better if the model is a solid
  single object (a union of parts) for size and loading optimization. KiCad
  supports STEP file int egration and can export board and component models
  into an integrated STEP file. This file can then be imported by a MCAD
  package.
* **WRL** (`.wrl`) files must be exported from its mechanical (STEP) model
  counterpart. WRL files are used for photo-realistic rendering using KiCad's
  raytracing rendering engine. This format supports more complex material
  properties, allowing various common component materials to be accurately
  rendered.

**Preferred method to create 3D models**

The model has to be created in a mechanical program, able to generate STEP
export. The model can be created by automatic scripts or manually.
[FreeCAD](https://www.freecadweb.org/) is the preferred software because it is
open source, and anyone can rework the model for future improvements, but also
other proprietary MCAD software are allowed. In case the model is generated by
scripts, the scripts should be linked to the PR stating software and version
used to run the scripts; when the model is manually created, the MCAD source
file should be added to the PR as well as STEP file. Text is not suggested on
models because of size increasing, anyway in case of text the fonts must be
licensed free as the word. WRL models should be exported from its mechanical
counterpart and, when possible, have the suggested material properties as in
these documents:

* [WRL Material Properties]
* [WRL Illumination model]

A simple method to export a fully compliant WRL model from a mechanical STEP
model is through [KiCad StepUp](https://github.com/easyw/kicadStepUpMod). A
tutorial video can be found [here](https://youtu.be/O6vr8QFnYGw). A good
starting point to learn how to create models by script is this github repo
[kicad-3d-models-in-freecad](https://github.com/easyw/kicad-3d-models-in-freecad).
The scripts are made in Python and run in FreeCAD with
[CadQuery module](https://github.com/jmwright/cadquery-freecad-module) add-on.

[WRL Material Properties]: https://gitlab.com/kicad/libraries/kicad-packages3D/-/blob/master/Vrml_materials_doc/KiCad_3D-Viewer_component-materials-reference-list_MarioLuzeiro.pdf "KiCad￼→ KiCad Libraries → KiCad Packages3D → Repository"
[WRL Illumination model]: https://gitlab.com/kicad/libraries/kicad-packages3D/-/blob/master/Vrml_materials_doc/KiCad_3D-Viewer_Illumination_model_and_materials-MarioLuzeiro.pdf "KiCad￼→ KiCad Libraries → KiCad Packages3D → Repository"

**Contribution**

The same rules as for the original (official) KiCad libraries shall apply
to your co- and contributed work. Contribution guidelines can be found
at http://kicad.org/libraries/contribute – The library convention can
be found at http://kicad.org/libraries/klc/

As an orientation of a good library structure the official (original)
[KiCad library documentation](https://kicad.github.io/) can be helpfull:

* [Symbols](https://kicad.github.io/symbols) – Schematic symbol libraries
* [Footprints](https://kicad.github.io/footprints) – PCB footprint libraries
* [3D models](https://kicad.github.io/packages3d) – 3D model data

**KLC exceptions and extensions**

* [S1.1] *Symbol libraries should be categorized by function* – Each symbol
  library name has field 6 *(Extra library descriptors)* containing the value
 `ESKD`. Existing keywords are supposed to be used and mix with this value as
  prefix (e.g.: `ESKD_Deprecated`).
* [S3.3] *Symbol outline and fill requirements* – Symbol body must have a line
  width of `0mil` (0mm) to use default value from template. The boxes of all
  symbols, regardless of their function as IC with hidden functionality or
  discrete component or those with a distinctive shape, should not have any
  fillings. In extremely rare cases, e.g. for marking mechanical details, the
  line color is used for filling. This achieves a particularly high contrast
  even in a black and white representation. However, these filled areas should
  only have a very small area in relation to the area of the entire symbol.

  **NOTE:** The CI workflow will exclude the KLC S3.3 rule check.

[S1.1]: https://klc.kicad.org/symbol/s1/s1.1/ "KLC: Symbol libraries should be categorized by function"
[S3.3]: https://klc.kicad.org/symbol/s3/s3.3/ "KLC: Symbol outline and fill requirements"

**KLC compliance check and 3D model coverage**

The KiCad library team has developed a set of
[Python scripts][kicad-library-utils] which can be used to help test if
library components conform to the KLC requirements. When a merge request
is made to the ESKD KiCad libraries, the contributed files are automatically
checked using these scripts. It can be helpful to run these scripts on your
local machine before submitting a PR, as it will help speed up the process
of merging your contribution(s) into the ESKD KiCad library.

Below you will see quick notes how to work with this helper scripts. See
more usage examples in the readme at the link above.

*Clone the KiCad library utility Python scripts*:
```sh
git clone --single-branch --depth 1 \
    https://gitlab.com/kicad/libraries/kicad-library-utils.git \
    /tmp/klc-utils
```

*Symbol Library Checker:*
```sh
/tmp/klc-utils/klc-check/check_symbol.py --help

/tmp/klc-utils/klc-check/check_symbol.py \
    --verbose symbols/*.kicad_sym

/tmp/klc-utils/klc-check/check_symbol.py \
    --verbose symbols/*.kicad_sym --footprints footprints

/tmp/klc-utils/klc-check/check_lib_table.py \
    --table symbols/sym-lib-table symbols/*.kicad_sym

# use the GitHub CI workflow scripts:
UTILS=/tmp/klc-utils NEWLIBS=. OLDLIBS=. \
./.github/qa-compliance/check_symbols.sh
```

*Footprint Checker:*
```sh
/tmp/klc-utils/klc-check/check_footprint.py --help

/tmp/klc-utils/klc-check/check_footprint.py \
    --verbose footprints/*.pretty/*.kicad_mod

/tmp/klc-utils/klc-check/check_lib_table.py \
    --table footprints/fp-lib-table footprints/*.pretty

# use the GitHub CI workflow scripts:
UTILS=/tmp/klc-utils NEWLIBS=. OLDLIBS=. \
./.github/qa-compliance/check_footprints.sh
```

*3D Model Checker:*
```sh
python3 /tmp/klc-utils/packages3d/check_3dmodels.py --help

python3 /tmp/klc-utils/packages3d/check_3dmodels.py \
    --verbose --pretty footprints/*.pretty \
              --models 3dmodels/*.3dshapes

# use the GitHub CI workflow scripts:
UTILS=/tmp/klc-utils NEWLIBS=. OLDLIBS=. \
./.github/qa-compliance/check_3dmodels.sh
```

*3D Model Coverage:*
```sh
/tmp/klc-utils/klc-check/check_3d_coverage.py --help

ln -rvsf 3dmodels footprints/packages3D \
&& /tmp/klc-utils/klc-check/check_3d_coverage.py \
       --verbose --usepackages3D --root footprints \
 ; rm -vf footprints/packages3D

# use the GitHub CI workflow scripts:
UTILS=/tmp/klc-utils NEWLIBS=. OLDLIBS=. \
./.github/qa-compliance/check_3d_coverage.sh
```

[kicad-library-utils]: https://gitlab.com/kicad/libraries/kicad-library-utils

Other ESKD KiCad repositories are located on:

* Environment: https://github.com/lipro-ecad/ESKD-kicad-environment
* Templates: https://github.com/lipro-ecad/ESKD-kicad-templates
* Sources: https://github.com/lipro-ecad/ESKD-kicad-sources
